# API 참조 📚

이 문서는 CryptoPay Rust SDK의 모든 API 인터페이스를 자세히 설명하며, 요청 매개변수, 반환 매개변수 및 예시를 포함합니다.

## 신규 사용자 등록 (create_user)🆕🧑‍💻

### 개념
새로운 플랫폼 사용자를 생성하며, 사용자의 고유 ID, 즉 UserOpenId가 필요합니다.

### HTTP 요청
- 인터페이스 이름: create_user
- URL: https://sandbox-api.privatex.io/sdk/user/create
- 방법: POST

### 요청 매개변수
| 매개변수 이름 | 필수 | 유형   | 설명                                                         |
| ------------- | ---- | ------ | ------------------------------------------------------------ |
| OpenId        | 예   | string | 플랫폼 표준 접두사 + 사용자 고유 ID를 추천하여 OpenId를 형성 |

### 반환 매개변수
| 매개변수 이름 | 유형   | 설명               |
| ------------- | ------ | ------------------ |
| code          | int    | 글로벌 상태 코드   |
| msg           | string | 상태 설명          |
| data.OpenId   | string | 사용자 고유 OpenId |
| sign          | string | 플랫폼 서명        |

### 예시
요청 예시:
```bash
curl --location 'https://sandbox-api.privatex.io/sdk/user/create' \
--header 'key: vratson2i5hjxgkd' \
--header 'sign: 0592dc64d480fb119d1e07ce06011db8' \
--header 'clientSign: xxxxxxxxxxxxxxxxx' \
--header 'Content-Type: application/json' \
--header 'timestamp: 1725076567682' \
--data '{ 
  "OpenId":"PT00001"
}'
```
반환 예시:
```json
{
    "code": 1,
    "msg": "ok",
    "data": {
        "OpenId": "PT00001"
    },
    "sign": "..."
}
```

인증 및 보안에 대해서는 [🧩 authentication.md](./authentication.md)를 참조하십시오.

## 지갑 생성 (create_wallet) 💰

### 개념
해당 블록체인 네트워크에서 사용자에게 지갑 계정을 생성합니다.

### HTTP 요청
- 인터페이스 이름: create_wallet
- URL: https://sandbox-api.privatex.io/sdk/wallet/create
- 방법: POST

### 요청 매개변수
| 매개변수 이름 | 필수 | 유형   | 설명               |
| ------------- | ---- | ------ | ------------------ |
| ChainID       | 예   | string | 체인 ID            |
| OpenId        | 예   | string | 사용자 고유 OpenId |

### 반환 매개변수
| 매개변수 이름 | 유형   | 설명               |
| ------------- | ------ | ------------------ |
| code          | int    | 글로벌 상태 코드   |
| msg           | string | 상태 설명          |
| data.address  | string | 지갑 주소          |
| data.OpenId   | string | 사용자 고유 OpenId |
| sign          | string | 플랫폼 서명        |

### 예시
요청 예시:
```bash
curl --location 'https://sandbox-api.privatex.io/sdk/wallet/create' \
--header 'key: vratson2i5hjxgkd' \
--header 'sign: 0592dc64d480fb119d1e07ce06011db8' \
--header 'clientSign: xxxxxxxxxxxxxxxxx' \
--header 'Content-Type: application/json' \
--header 'timestamp: 1725076567682' \
--data '{
  "OpenId":"PT00001",
  "ChainID":"1"
}'
```
반환 예시:
```json
{
    "code": 1,
    "msg": "ok",
    "data": {
        "address": "...",
        "OpenId": "PT00001"
    },
    "sign": "..."
}
```

## 입금 주소 가져오기 (get_wallet_addresses)💳

### 개념
사용자의 블록체인 지갑 입금 주소를 가져옵니다.

### HTTP 요청
- 인터페이스 이름: get_wallet_addresses
- URL: https://sandbox-api.privatex.io/sdk/wallet/getWalletAddresses
- 방법: POST

### 요청 매개변수
| 매개변수 이름 | 필수 | 유형   | 설명                      |
| ------------- | ---- | ------ | ------------------------- |
| OpenId        | 예   | string | 사용자 고유 OpenId        |
| ChainIDs      | 예   | string | 여러 체인 ID, 쉼표로 구분 |

### 반환 매개변수
| 매개변수 이름  | 유형   | 설명             |
| -------------- | ------ | ---------------- |
| code           | int    | 글로벌 상태 코드 |
| msg            | string | 상태 설명        |
| data.Addresses | array  | 주소 목록        |
| sign           | string | 플랫폼 서명      |

### 예시
요청 예시:
```bash
curl --location 'https://sandbox-api.privatex.io/sdk/wallet/getWalletAddresses' \
--header 'key: vratson2i5hjxgkd' \
--header 'sign: 0592dc64d480fb119d1e07ce06011db8' \
--header 'clientSign: xxxxxxxxxxxxxxxxx' \
--header 'Content-Type: application/json' \
--header 'timestamp: 1725076567682' \
--data '{
  "OpenId":"PT00001",
  "ChainIDs":"56,2"
}'
```
반환 예시:
```json
{
    "code": 1,
    "msg": "ok",
    "data": {
        "Addresses": [
            {
                "chainID": 56,
                "address": "..."
            }
        ]
    },
    "sign": "..."
}
```

## 사용자 출금 (user_withdraw_by_open_id)💸

### 개념
사용자 출금 작업, 파트너 계정에서 사용자 지정 주소로 이체.

* 기능: 사용자 출금 작업 인터페이스. 출금은 해당 토큰 출금 풀의 파트너 계정에서 사용자가 지정한 출금 지갑 주소로 이체되어야 합니다. 파트너는 출금의 합법성을 확인하기 위해 보안 콜백 주소를 설정할 수 있습니다. 유효하다고 확인되면 상인의 자금 풀 지갑에서 직접 출금을 완료할 수 있습니다.

* 출금 거래 인터페이스는 기본 출금 핫 지갑에 충분한 출금 자산과 수수료가 있는지 확인합니다.

* 기본적으로 출금 인터페이스는 보안 확인 코드를 출금 거래의 고유 매개변수 요구사항으로 사용합니다. 일반적으로 비즈니스 플랫폼의 고유 출금 주문 번호를 보안 코드로 사용하는 것을 추천합니다. 중복된 보안 확인 코드를 제출하면 오류가 발생합니다.

* 모든 출금 거래 요청은 채널 플랫폼에 구성된 위험 제어 검토 규칙과 일치합니다. 매개변수 요청이 유효하면 거래 요청이 수락됩니다. 자동 검토 규칙을 충족하는 출금 거래는 즉시 네트워크 거래에 제출되며 제출된 거래의 해시 정보가 반환됩니다 (반환 필드 data). 채널에서 2차 검토가 필요한 출금 거래 요청은 (code=2)를 반환합니다. 출금 요청을 다시 제출할 필요가 없습니다. 관리자는 채널 플랫폼에서 2차 검토를 완료해야 합니다. 2차 검토가 완료된 후 거래 주문은 콜백을 통해 출금 거래 상태 변경을 알립니다.

* 전제 조건: 해당 통화의 자금 풀에 충분한 출금 금액이 있어야 합니다 (특히 ETH 네트워크 토큰 출금의 경우 자금 풀 지갑에 일정 금액의 ETH 거래 수수료 잔액이 필요합니다).

* ⚠️ 참고: **블록체인 출금의 경우 인터페이스를 호출하기 전에 사전 승인 프로세스가 완료되었는지 확인하십시오. 블록체인 거래가 시작되면 취소하거나 반환할 수 없습니다.**

### HTTP 요청
- 인터페이스 이름: user_withdraw_by_open_id
- URL: https://sandbox-api.privatex.io/sdk/partner/UserWithdrawByOpenID
- 방법: POST

### 요청 매개변수
| 매개변수 이름 | 필수   | 유형   | 설명               |
| ------------- | ------ | ------ | ------------------ |
| OpenId        | 예     | string | 사용자 고유 OpenId |
| TokenId       | 예     | string | 토큰 ID            |
| Amount        | 예     | float  | 출금 금액          |
| AddressTo     | 예     | string | 대상 주소          |
| CallBackUrl   | 아니오 | string | 콜백 URL           |
| SafeCheckCode | 아니오 | string | 보안 확인 코드     |

### 반환 매개변수

| 매개변수 이름 | 유형   | 설명                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| :------------ | :----- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| code          | int    | 상태 코드</br>0 매개변수 오류, 중복 주문 번호, 잘못된 출금 주소 형식 또는 부족한 출금 지갑 수수료. 자세한 정보는 msg에서 확인할 수 있습니다.</br>1 출금 거래가 성공적으로 제출되었으며 블록체인 네트워크에 제출되었습니다. 제출된 거래의 고유 해시는 data에 포함됩니다.</br>2 출금 거래가 성공적으로 제출되었으며 거래를 완료하기 전에 2차 채널 검토가 필요합니다. 검토가 완료된 후 거래 정보는 콜백을 통해 업데이트됩니다.</br>-1 출금 거래가 실패했습니다. 출금 요청을 다시 제출할 수 있습니다. |
| msg           | string | 상태 설명                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| data          | string | 거래 해시. 스마트 출금이 활성화된 경우 이 필드는 빈 문자열로 반환됩니다.                                                                                                                                                                                                                                                                                                                                                                                                                          |
| sign          | string | 플랫폼 서명                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| timestamp     | string | 밀리초로 변환된 현재 타임스탬프 문자열                                                                                                                                                                                                                                                                                                                                                                                                                                                            |


### 예시
요청 예시:
```bash
curl --location 'https://sandbox-api.privatex.io/sdk/partner/UserWithdrawByOpenID' \
--header 'key: vratson2i5hjxgkd' \
--header 'sign: 0592dc64d480fb119d1e07ce06011db8' \
--header 'clientSign: xxxxxxxxxxxxxxxxx' \
--header 'Content-Type: application/json' \
--header 'timestamp: 1725076567682' \
--data '{ 
  "OpenId": "PT00001", 
  "TokenId": "4", 
  "Amount": "0.02", 
  "AddressTo": "TQdL5yttJPTx7hJmBhGfo2LcE7AXLPtHSg", 
  "CallBackUrl": "http://xxxxxx/withdraw_callback", 
  "SafeCheckCode": "1000000000000000"
}'
```

반환 예시
```json
{
    "sign": "D+VTPNiwGLzh9eIvkrscwS4UlGKzdnrBgB63RDG4HeobZT6FXqUwYCPgKojynKaxwm5PkmW0xhIASZ4asSCvnYfi0NSFehchZAtUnQIispxKcjsiudWsUznbkEIQ2h2TA/mbUZ1X9+wyh7QhNo6+RkxtgRyRpVb7ARG8pL14cdTAs OTtMLO0W1GO0M83VAv2ybBZNObncX9qy6tdwLQV/KYuNJYyMN0dL0nLKYHnj9Q4d3lEDM45AVJ0153/YIiIgcF BnOWhsQ9rVARcFeXeWd9KJ5OZpmxlxnhcJGcEUY2UDC4zKLZxtUet7CPAyehAMQ5plkpvRrR3Z6lA5zl6GQ==",
    "timestamp": "1725439986754",
    "data": "94f4c29eba73d53dcd3aa1b8cf90a98108d0acf82f38b97a4032dcdf7ff172e7",
    "msg": "ok",
    "code": 1
}
```

## 출금 주문 2차 검토 💳

* 기능: 상인 출금 주문 위험 제어 2차 검토 인터페이스
* ⚠️ 참고: **플랫폼은 상인에게 별도의 위험 제어 RSA 공개 키를 할당합니다 (입금/출금 콜백 알림 공개 키와 다름)**
* 트리거 시간: 관리자가 상인 측 (시스템 설정)에서 위험 제어 콜백 URL 매개변수를 구성한 후 채널은 각 출금 거래 요청에 대해 추가 위험 제어 콜백 2차 검토를 추가합니다. 상인 측 위험 제어 URL이 올바른 확인 통과 코드를 반환할 때만 거래가 유효하게 제출됩니다.
* 기술 요구사항: 상인 측 기술 구현 및 2차 검토 콜백 인터페이스 구성 필요.

#### HTTP 요청

플랫폼이 상인에게 출금 검토 요청을 보냅니다.

> POST: `/withdrawal/order/check`

#### 요청 매개변수

| 매개변수 이름 | 필수   | 유형   | 설명                                                                                                        |
| :------------ | :----- | :----- | :---------------------------------------------------------------------------------------------------------- |
| safeCode      | 아니오 | string | 상인이 제출한 고유 거래 ID, 일반적으로 상인의 출금 주문 ID에 해당 (출금 거래의 SafeCheckCode)               |
| openId        | 예     | string | 출금 거래를 제출한 상인의 사용자 ID                                                                         |
| tokenId       | 예     | string | 통화 ID, 플랫폼에서 제공한 통화 ID 기준                                                                     |
| toAddress     | 예     | string | 출금 주소                                                                                                   |
| amount        | 예     | string | 출금 금액                                                                                                   |
| timestamp     | 예     | int    | 현재 타임스탬프                                                                                             |
| sign          | 예     | string | 서명: 데이터 필드의 매개변수만 서명; 플랫폼의 위험 제어 RSA 공개 키를 사용하여 서명의 정확성을 확인해야 함. |

#### 반환 매개변수 설명

| 매개변수 이름 | 유형   | 설명                                                              |
| :------------ | :----- | :---------------------------------------------------------------- |
| code          | int    | 확인 결과. 0은 통과를 나타냄; 다른 코드는 유효하지 않음.          |
| timestamp     | int    | 현재 타임스탬프, 초 단위.                                         |
| message       | string | 반환 메시지.                                                      |
| sign          | string | 서명: 응답 매개변수의 데이터 필드에 대한 상인의 RSA 개인 키 서명. |

## 입금 및 출금 콜백 알림

1. 입금 및 출금 거래는 여러 콜백 알림을 트리거합니다. 마지막 콜백 알림의 거래 정보 및 상태가 사용됩니다.
2. 비즈니스 측은 유효한 콜백 메시지를 반환해야 합니다. 형식은 반환 매개변수 설명에 설명되어 있습니다. 반환 코드 0은 콜백 메시지가 처리되었으며 더 이상 알림이 필요하지 않음을 나타냅니다. 그렇지 않으면 콜백은 계속 알림을 보냅니다 (처음에는 2초마다 50회, 그 후 10분마다) 코드 0의 확인 메시지가 반환될 때까지.

콜백 URL을 설정하려면 서비스 제공자에게 문의하십시오.

> POST

* 기능: 플랫폼이 애플리케이션 측에 토큰 거래 정보 (사용자 출금 또는 입금)를 알리기 위해 사용하는 콜백 메시지 형식을 정의합니다. 이 메시지는 토큰 거래 상태 (출금 또는 입금)에 대한 애플리케이션 측 이벤트 알림에 적합합니다. 애플리케이션은 애플리케이션 기능에 따라 콜백 알림 인터페이스를 선택적으로 지원할 수 있습니다.

### 요청 매개변수

| 매개변수 이름 | 필수 | 유형   | 설명                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| :------------ | :--- | :----- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| openid        | 예   | string | 채널 사용자 고유 ID                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| totalvalue    | 예   | string | 입금 또는 출금 거래에 해당하는 USDT 가치 (거래 시 시장 가격에 따라 계산)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| status        | 예   | int    | 거래 상태:</br>1 거래가 완료되었으며 블록체인 네트워크에 성공적으로 제출되었습니다. 해시를 사용하여 체인에서 거래 세부 정보를 쿼리할 수 있습니다.</br>-1 거래가 블록체인 네트워크에 제출되었지만 체인 거래가 실패했습니다. 상인 관리 --> 거래 관리 --> [주문 보안 코드 제출]에서 다시 검토할 수 있습니다. 비즈니스 플랫폼은 상태 변경을 처리할 필요가 없으며 채널이 콜백으로 새로운 상태 알림을 기다릴 수 있습니다.</br>-2 출금 거래 신청이 상인 백엔드에서 거부되었습니다. 출금 신청이 만료되었습니다. 알림을 받은 후 비즈니스 플랫폼이 사용자의 출금 신청을 반환하는 것을 추천합니다.</br>2 출금 거래가 상인 관리에 제출되었습니다. 구성된 통화 보안 위험 제어 요구사항을 트리거했기 때문에 관리자는 상인 관리 --> 거래 관리 --> 출금 검토에 로그인하여 출금 신청 처리를 완료해야 합니다.</br>3 출금 거래 블록체인 처리 중, 비즈니스 플랫폼은 상태 변경을 업데이트할 필요가 없으며 채널이 새로운 상태 알림을 받을 때까지 기다릴 수 있습니다. </br>⛑️**특별 알림: 비즈니스 플랫폼이 받은 출금 거래 콜백에서 status = -1인 경우 콜백을 무시합니다. 관리자가 관리 백엔드에 로그인하여 거래를 다시 제출한 후 새로운 상태 알림이 플랫폼에 동시에 푸시됩니다.** |  | type | 예 | int | 1은 입금 거래; 2는 출금 거래 |
| hash          | 예   | string | 거래 해시 값                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| confirm       | 예   | int    | 거래의 체인 확인 수                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| createdtime   | 예   | string | 생성 시간                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| from          | 예   | string | 거래 시작 주소                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| to            | 예   | string | 거래 수신 주소                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |