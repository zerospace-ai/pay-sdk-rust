# API Справка

## Регистрация нового пользователя

### Концепция

Регистрация нового пользователя в системе CryptoPay. После успешной регистрации возвращается уникальный идентификатор пользователя (openId).

### HTTP-запрос

POST /api/v1/user/register

### Описание параметров запроса

| Имя параметра | Обязательно | Тип | Описание |
| :-------- | :--- | :----- | :------------------------------------------------------------------------- |
| key | Да | string | Ключ API, предоставленный платформой |
| timestamp | Да | int | Текущая временная метка |
| sign | Да | string | Подпись: Подписывается только параметры в поле data; правильность подписи должна быть проверена с использованием публичного ключа RSA платформы |
| clientSign | Да | string | Подпись клиента: Подписывается только параметры в поле data; правильность подписи должна быть проверена с использованием публичного ключа RSA клиента |

#### Поле data

| Имя параметра | Обязательно | Тип | Описание |
| :-------- | :--- | :----- | :------------------------------------------------------------------------- |
| username | Да | string | Имя пользователя |
| password | Да | string | Пароль |
| email | Нет | string | Электронная почта |

### Описание возвращаемых параметров

| Имя параметра | Тип | Описание |
| :-------- | :----- | :----------------------------------------------------- |
| code | int | Результат. 0 указывает на успех; другие коды - на ошибку. |
| timestamp | int | Текущая временная метка, в секундах. |
| message | string | Сообщение возврата. |
| data | object | Данные возврата. |
| sign | string | Подпись: Подпись приватным ключом RSA торговца для поля data в параметрах ответа. |

#### Поле data

| Имя параметра | Тип | Описание |
| :-------- | :----- | :----------------------------------------------------- |
| openId | string | Уникальный идентификатор пользователя |

### Пример

```json
{
  "code": 0,
  "timestamp": 1627891234,
  "message": "Success",
  "data": {
    "openId": "user_open_id_123"
  },
  "sign": "signature_here"
}
```

## Создание кошелька

### Концепция

Создание кошелька для пользователя. Поддерживает несколько цепочек и токенов.

### HTTP-запрос

POST /api/v1/wallet/create

### Описание параметров запроса

| Имя параметра | Обязательно | Тип | Описание |
| :-------- | :--- | :----- | :------------------------------------------------------------------------- |
| key | Да | string | Ключ API |
| timestamp | Да | int | Текущая временная метка |
| sign | Да | string | Подпись |
| clientSign | Да | string | Подпись клиента |

#### Поле data

| Имя параметра | Обязательно | Тип | Описание |
| :-------- | :--- | :----- | :------------------------------------------------------------------------- |
| openId | Да | string | Идентификатор пользователя |
| chainId | Да | string | Идентификатор цепочки |
| tokenId | Да | string | Идентификатор токена |

### Описание возвращаемых параметров

Аналогично предыдущему.

## Получение адреса пополнения

### Концепция

Получение адреса для пополнения счета пользователя.

### HTTP-запрос

GET /api/v1/wallet/deposit/address

### Описание параметров запроса

| Имя параметра | Обязательно | Тип | Описание |
| :-------- | :--- | :----- | :------------------------------------------------------------------------- |
| openId | Да | string | Идентификатор пользователя |
| tokenId | Да | string | Идентификатор токена |

### Описание возвращаемых параметров

| Имя параметра | Тип | Описание |
| :-------- | :----- | :----------------------------------------------------- |
| address | string | Адрес пополнения |

## Вывод средств пользователя

### Концепция

Инициирование вывода средств для пользователя.

### HTTP-запрос

POST /api/v1/wallet/withdraw

### Описание параметров запроса

| Имя параметра | Обязательно | Тип | Описание |
| :-------- | :--- | :----- | :------------------------------------------------------------------------- |
| openId | Да | string | Идентификатор пользователя |
| tokenId | Да | string | Идентификатор токена |
| toAddress | Да | string | Адрес получателя |
| amount | Да | string | Сумма вывода |

### Описание возвращаемых параметров

Аналогично.

## Вторичная проверка заказа на вывод

### Концепция

Вторичная проверка заказа на вывод для обеспечения безопасности.

### HTTP-запрос

POST /api/v1/wallet/withdraw/verify

### Описание параметров запроса

| Имя параметра | Обязательно | Тип | Описание |
| :-------- | :--- | :----- | :------------------------------------------------------------------------- |
| safeCode | Нет | string | Уникальный ID транзакции |
| openId | Да | string | Идентификатор пользователя |
| tokenId | Да | string | Идентификатор токена |
| toAddress | Да | string | Адрес вывода |
| amount | Да | string | Сумма вывода |
| timestamp | Да | int | Текущая временная метка |
| sign | Да | string | Подпись |

### Описание возвращаемых параметров

| Имя параметра | Тип | Описание |
| :-------- | :----- | :----------------------------------------------------- |
| code | int | Результат проверки. 0 - пройдено. |
| timestamp | int | Текущая временная метка. |
| message | string | Сообщение. |
| sign | string | Подпись. |

## Уведомления о пополнениях и выводах

1. Транзакции пополнения и вывода вызывают несколько уведомлений. Используется информация и статус последнего уведомления.
2. Бизнес-сторона должна возвращать действительное сообщение обратного вызова. Формат описан в описании возвращаемых параметров. Код возврата 0 указывает, что сообщение обработано и дальнейшие уведомления не требуются. В противном случае уведомления продолжаются.

Свяжитесь с поставщиком услуг для установки URL обратного вызова.

> POST

* Функция: Определяет формат сообщения обратного вызова, который платформа использует для уведомления приложения о информации о транзакциях токенов (вывод или пополнение пользователя). Это сообщение подходит для уведомлений о событиях на стороне приложения относительно статуса транзакций токенов (вывод или пополнение). Приложения могут опционально поддерживать интерфейс уведомлений обратного вызова на основе своей функциональности приложения.

### Параметры запроса

| Имя параметра | Обязательно | Тип | Описание |
| :----------- | :--- | :----- |:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| openid | да | string | Уникальный ID пользователя канала |
| totalvalue | да | string | Значение USDT, соответствующее транзакции пополнения или вывода (рассчитывается на основе рыночной цены на момент транзакции) |
| status | да | int | Статус транзакции:</br>1 Транзакция завершена и успешно отправлена в сеть блокчейна. Детали транзакции можно запросить в цепочке с использованием хэша.</br>-1 Транзакция отправлена в сеть блокчейна, но транзакция в цепочке не удалась. Вы можете повторно проверить в Управлении торговцем --> Управление транзакциями --> [Код безопасности отправки заказа]. Бизнес-платформа не нуждается в обработке изменения статуса и может просто ждать уведомления о новом статусе от канала.</br>-2 Заявка на вывод отклонена backend торговца. Заявка на вывод истекла. Рекомендуется, чтобы бизнес-платформа вернула заявку на вывод пользователя после получения уведомления.</br>2 Транзакция вывода отправлена в управление торговцем. Поскольку она сработала настроенные требования риск-контроля валюты безопасности, администратор должен войти в Управление торговцем --> Управление транзакциями --> Проверка вывода для завершения обработки заявки на вывод.</br>3 Во время обработки блокчейна транзакции вывода бизнес-платформа не нуждается в обновлении изменения статуса и может просто ждать получения нового уведомления о статусе от канала. </br>⛑️**Специальное напоминание: Для уведомлений о транзакциях вывода, полученных бизнес-платформой, если status = -1, уведомление будет игнорироваться. После того, как администратор войдет в backend управления и повторно отправит транзакцию, новое уведомление о статусе будет одновременно отправлено на платформу.** || type | да | int | 1 для транзакций пополнения; 2 для транзакций вывода |
| hash | да | string | Значение хэша транзакции |
| confirm | да | int | Количество подтверждений в цепочке для транзакции |
| createdtime | да | string | Время создания |
| from | да | string | Адрес инициатора транзакции |
| to | да | string | Адрес получателя транзакции |