# リクエスト検証ヘッダー

リクエストヘッダー定義

| パラメータ名 | 制約      | 例                                 | 説明                                           |
| :----------- | :-------- | :--------------------------------- | :--------------------------------------------- |
| key          | 長さ: 64  | ithujj3onrzbgw5t                   | パートナーキー                                 |
| timestamp    | 長さ: 32  | 1722586649000                      | リクエスト開始のタイムスタンプ（単位: ミリ秒） |
| sign         | 長さ: 32  | 9e0ccfe3915e94bcc5bf7dd51ad4e8d9   | パートナーシークレット署名                     |
| clientSign   | 長さ: 512 | 9e0ccfe3915e94bcc5bfbBsC5EUxV6 ... | パートナーRSA署名                              |

## `sign` フィールドのルール

1. パートナーを登録し、`key` と `secret` を取得します。
2. リクエストを解析します。JSONボディをJSONのキーによってASCII昇順でソートし、文字列をdataStr=key1=value1&key2=value2&key3=value3&... のように連結します。
3. タイムスタンプを生成します（単位: ミリ秒）。
4. 暗号化してsignを生成します: 暗号化前のプレーンテキスト: strToHash = Secret+dataStr+timestamp プレーンテキストstrToHashに対してMD5暗号化を行い、signを生成します。
特定のコードはGenerateMD5Sign関数です。
5. key、timestamp、およびsignをHTTPヘッダーに配置します。

## `clientSign` 署名アルゴリズムの詳細説明

1. リクエストパラメータを取得し、フォーマットして新しいフォーマットされた文字列を取得します。

2. ステップ1のデータをRSA秘密鍵で署名し、署名結果を変数に保存します。
以下のパラメータ配列に対する署名文字列を生成します: `user_id = 1 coin = eth address = 0x038B8E7406dED2Be112B6c7E4681Df5316957cad amount = 10.001 trade_id = 20220131012030274786`
配列内の各キーをaからzまでソートします。最初の文字が同じ場合、2番目の文字を見ます。以降同様です。ソート後、すべての配列値をアンパサンド（&）文字で連結します。例えば、$dataStringで:
`address=0x038B8E7406dED2Be112B6c7E4681Df5316957cad&amount=10.001&coin=eth&trade_id=20220131012030274786&user_id=1`
この文字列が連結された文字列です。

3. 秘密鍵を使用してRSA-MD5でデータを署名します。特定のコードはGenerateRSASignature関数にあります。

# 公開情報

| 名前                       | タイプ    | 例                                 | 説明                                                                     |
| :------------------------- | :-------- | :--------------------------------- | :----------------------------------------------------------------------- |
| グローバルステータスコード | integer   | 1                                  | 1 は成功を示します。詳細はグローバルステータスコードを参照してください。 |
| メッセージ                 | string    | ok                                 | テキスト情報を返します。                                                 |
| データ                     | json      | {"OpenID":"HEX..."}                | 特定のデータ内容を返します。                                             |
| 時間                       | timeStamp | 1722587274000                      | UTC 時間（タイムゾーンなし、ミリ秒単位）。                               |
| Sign                       | string    | 9e0ccfe3915e94bcc5bfbBsC5EUxV6 ... | プラットフォームは RSA を使用してすべてのデータを署名します。            |

プラットフォームから返されるSignは、レスポンスデータをRSAアルゴリズムを使用して暗号化した結果です。フロントエンドは返されたデータに対して署名を検証する必要があります。詳細は関数 func: 

pub fn verify_rsa_signature` を参照してください。